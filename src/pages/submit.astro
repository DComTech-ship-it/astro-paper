---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Breadcrumb from "@/components/Breadcrumb.astro";
import { SITE } from "@/config";

const backUrl = SITE.showBackButton ? Astro.url.pathname : "/";
---

<Layout title="Submit Your Story | Mia woezÉ”">
  <Header />
  <Breadcrumb />
  <main data-backUrl={backUrl} id="main-content" class="app-layout pb-4">
    <h1 class="text-2xl font-semibold sm:text-3xl">Submit Your Story</h1>
    
    <section class="max-w-4xl mx-auto px-4 py-12">
      <div class="max-w-2xl mx-auto">
        <form 
          id="guest-post-form"
          class="space-y-6"
        >
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label for="name" class="block text-sm font-medium mb-2">
                Your Name *
              </label>
              <input
                type="text"
                id="name"
                name="name"
                required
                class="w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"
                placeholder="John Doe"
              />
            </div>
            
            <div>
              <label for="email" class="block text-sm font-medium mb-2">
                Email Address *
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"
                placeholder="john@example.com"
              />
            </div>
          </div>

          <div>
            <label for="title" class="block text-sm font-medium mb-2">
              Post Title *
            </label>
            <input
              type="text"
              id="title"
              name="title"
              required
              class="w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"
              placeholder="Your inspiring story title"
            />
          </div>

          <div>
            <label for="category" class="block text-sm font-medium mb-2">
              Category *
            </label>
            <select
              id="category"
              name="category"
              required
              class="w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"
            >
              <option value="">Select a category</option>
              <option value="creativity">Creativity</option>
              <option value="inspiration">Inspiration</option>
              <option value="practical-tips">Practical Tips</option>
              <option value="community">Community</option>
              <option value="growth">Personal Growth</option>
            </select>
          </div>

          <div>
            <label for="content" class="block text-sm font-medium mb-2">
              Your Story *
            </label>
            <textarea
              id="content"
              name="content"
              required
              rows="12"
              class="w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"
              placeholder="Share your authentic story, practical tips, or inspiring experience..."
            ></textarea>
          </div>

          <div>
            <label for="bio" class="block text-sm font-medium mb-2">
              Short Bio *
            </label>
            <textarea
              id="bio"
              name="bio"
              required
              rows="3"
              class="w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"
              placeholder="Tell us briefly about yourself..."
            ></textarea>
          </div>

          <div>
            <label for="avatar-upload" class="block text-sm font-medium mb-2">
              Profile Picture (Optional)
            </label>
            <input
              type="file"
              id="avatar-upload"
              name="avatar-upload"
              accept="image/*"
              class="w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"
            />
            <p class="text-sm text-muted mt-1">
              Upload a profile picture (JPG, PNG). Square images work best. Max size: 2MB
            </p>
          </div>

          <div>
            <label for="social-links" class="block text-sm font-medium mb-2">
              Social Links (Optional)
            </label>
            <input
              type="url"
              id="social-links"
              name="social-links"
              class="w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"
              placeholder="https://twitter.com/yourhandle"
            />
          </div>

          <div>
            <label for="file-upload" class="block text-sm font-medium mb-2">
              Upload File (Optional)
            </label>
            <input
              type="file"
              id="file-upload"
              name="file-upload"
              accept="image/*,.pdf,.doc,.docx,.txt"
              class="w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"
            />
            <p class="text-sm text-muted mt-1">
              Accepted formats: Images (JPG, PNG, GIF), Documents (PDF, DOC, DOCX, TXT). Max size: 10MB
            </p>
          </div>

          <div class="bg-muted p-4 rounded-lg">
            <h3 class="font-semibold mb-2">Submission Guidelines</h3>
            <ul class="text-sm space-y-1 list-disc list-inside">
              <li>Be authentic and original - no plagiarism</li>
              <li>Keep content positive and uplifting</li>
              <li>Minimum 300 words for stories</li>
              <li>Proofread before submitting</li>
              <li>We reserve the right to edit for clarity</li>
              <li>You'll be notified via email within 3-5 days</li>
            </ul>
          </div>

          <div class="flex items-start">
            <input
              type="checkbox"
              id="agreement"
              name="agreement"
              required
              class="mt-1 mr-2"
            />
            <label for="agreement" class="text-sm">
              I agree to the submission guidelines and understand that my content may be edited for clarity and length *
            </label>
          </div>

          <div class="flex justify-center">
            <button
              type="submit"
              class="px-8 py-3 bg-accent text-background rounded-lg hover:bg-accent/90 transition-colors font-medium text-lg"
            >
              Submit Your Story
            </button>
          </div>
        </form>
      </section>
    </main>
    <Footer />
  </Layout>

<script>
  // Form submission with Resend API
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('guest-post-form') as HTMLFormElement;
    const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
    
    if (form) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.textContent = 'Submitting...';
        }
        
        try {
          const formData = new FormData(form);
          const submissionData = {
            name: formData.get('name'),
            email: formData.get('email'),
            title: formData.get('title'),
            category: formData.get('category'),
            content: formData.get('content'),
            bio: formData.get('bio'),
            socialLinks: formData.get('social-links'),
            agreement: formData.get('agreement'),
            submittedAt: new Date().toISOString()
          };
          
          // Send to Resend API
          const response = await fetch('/api/submit', {
            method: 'POST',
            body: formData // Send FormData directly for file uploads
          });
          
          if (response.ok) {
            form.reset();
            alert('Thank you! Your story has been submitted successfully. We\'ll review it and get back to you within 3-5 days.');
          } else {
            throw new Error('Submission failed');
          }
        } catch (error) {
          console.error('Submission error:', error);
          alert('Sorry, there was an error submitting your story. Please try again or contact us directly.');
        } finally {
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Your Story';
          }
        }
      });
    }
  });
</script>
